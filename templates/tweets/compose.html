{% extends 'base.html' %}

{% block title %}Compose Tweet - ùïè-Pilot{% endblock %}

{% block content %}
<div class="compose-header">
    <h1>Compose Tweet</h1>
    <a href="{{ url_for('tweets.index') }}" class="btn btn-secondary">Cancel</a>
</div>

<div class="compose-container">
    <form method="post" action="{{ url_for('tweets.compose') }}" id="tweet-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="form-group">
            <label for="tweet-text">What's happening?</label>
            <textarea
                name="text"
                id="tweet-text"
                class="tweet-input"
                placeholder="What's on your mind?"
                maxlength="{{ char_limit|default(280) }}"
                required
            >{{ text if text is defined else '' }}</textarea>
            <div class="character-counter">
                <span id="char-count">0</span>/<span id="char-limit">{{ char_limit|default(280) }}</span>
                {% if premium|default(false) %}
                <span class="premium-badge">Premium</span>
                {% endif %}
            </div>
        </div>

        <div class="form-actions">
            <div class="schedule-options">
                <label for="schedule">
                    <input type="checkbox" name="schedule" id="schedule">
                    Schedule for later
                </label>

                <div id="schedule-details" class="schedule-details hidden">
                    <div class="datetime-inputs">
                        <div class="form-group date-group">
                            <label for="schedule-date">Date</label>
                            <input type="date" name="schedule_date" id="schedule-date" class="date-input">
                        </div>
                        <div class="form-group time-group">
                            <label for="schedule-time">Time</label>
                            <input type="time" name="schedule_time" id="schedule-time" class="time-input">
                        </div>
                    </div>
                </div>
            </div>

            <div class="submit-group">
                <button type="submit" class="btn" id="tweet-button">Tweet</button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tweetText = document.getElementById('tweet-text');
        const charCount = document.getElementById('char-count');
        const charLimit = document.getElementById('char-limit');
        const tweetButton = document.getElementById('tweet-button');
        const scheduleCheckbox = document.getElementById('schedule');
        const scheduleDetails = document.getElementById('schedule-details');

        // Get character limit from the template
        const maxCharacters = parseInt(charLimit.textContent, 10) || 280;

        // Character counter
        tweetText.addEventListener('input', function() {
            updateCharCount();
        });

        // Function to update character count
        function updateCharCount() {
            const count = tweetText.value.length;
            charCount.textContent = count;

            if (count > maxCharacters) {
                charCount.classList.add('over-limit');
                tweetButton.disabled = true;
            } else {
                charCount.classList.remove('over-limit');
                tweetButton.disabled = false;
            }
        }

        // Initialize character count
        updateCharCount();

        // Show/hide schedule options
        scheduleCheckbox.addEventListener('change', function() {
            const scheduleDate = document.getElementById('schedule-date');
            const scheduleTime = document.getElementById('schedule-time');

            if (this.checked) {
                scheduleDetails.classList.remove('hidden');
                tweetButton.textContent = 'Schedule';

                // Enable schedule fields
                scheduleDate.disabled = false;
                scheduleTime.disabled = false;
            } else {
                scheduleDetails.classList.add('hidden');
                tweetButton.textContent = 'Tweet';

                // Disable schedule fields so they won't be submitted with the form
                scheduleDate.disabled = true;
                scheduleTime.disabled = true;
            }
        });

        // Set default date and time if scheduling
        document.getElementById('schedule-date').valueAsDate = new Date();

        // Set default time to next hour
        const now = new Date();
        now.setHours(now.getHours() + 1);
        now.setMinutes(0);

        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        document.getElementById('schedule-time').value = `${hours}:${minutes}`;

        // Initialize schedule fields state based on checkbox
        const scheduleDate = document.getElementById('schedule-date');
        const scheduleTime = document.getElementById('schedule-time');
        scheduleDate.disabled = !scheduleCheckbox.checked;
        scheduleTime.disabled = !scheduleCheckbox.checked;
    });
</script>
{% endblock %}

{% block extra_css %}
<style>
    .compose-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .compose-container {
        background-color: var(--very-light-gray);
        border-radius: 8px;
        padding: 1.5rem;
        max-width: 650px;
        margin: 0 auto;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .tweet-input {
        width: 100%;
        min-height: 150px;
        padding: 1rem;
        border: 1px solid var(--light-gray);
        border-radius: 8px;
        margin-top: 0.5rem;
        font-family: inherit;
        font-size: 1rem;
        resize: vertical;
    }

    .tweet-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(29, 161, 242, 0.2);
    }

    .character-counter {
        text-align: right;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: var(--secondary-color);
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 0.5rem;
    }

    .premium-badge {
        background-color: #f7c427;
        color: #333;
        font-size: 0.7rem;
        font-weight: bold;
        padding: 0.2rem 0.4rem;
        border-radius: 4px;
    }

    .over-limit {
        color: var(--danger-color);
        font-weight: bold;
    }

    .form-actions {
        margin-top: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .schedule-options {
        font-size: 0.875rem;
    }

    .schedule-details {
        margin-top: 1rem;
    }

    .hidden {
        display: none;
    }

    .datetime-inputs {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
    }

    .date-group, .time-group {
        flex: 1;
    }

    .date-input, .time-input {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid var(--light-gray);
        border-radius: 4px;
    }

    .btn-secondary {
        background-color: var(--light-gray);
        color: var(--text-color);
    }

    .btn-secondary:hover {
        background-color: var(--secondary-color);
        color: white;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
</style>
{% endblock %}
